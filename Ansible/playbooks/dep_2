---

- name: Deploy TROLoadBank application as a swarm service
  hosts: '{{ HOSTS }}' 
  become: true
  gather_facts: true

  vars:
    image: jasmit/troloadbank
    tag: 25.1.0.4

  tasks:

    - name: Ensure Docker is installed
      ansible.builtin.package:
        name: docker.io
        state: present

    - name: Ensure Docker is running
      ansible.builtin.service:
        name: docker
        state: started
        enabled: true

    - name: Deploy a container using the image
      ansible.builtin.shell: >
        docker service create \
          --name troloadbank \
          --detach \
          --hostname troload \
          --mount type=bind,source=/Volumes/synology_nfs,destination=/Volumes/nfs_volume \
          {{ image }}:{{ tag }}

    #  Sample use:
    #  make PLAYBOOK=troloadbank_deploy HOSTS=enki, run-on-hosts

...
