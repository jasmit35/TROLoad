---

- name: Deploy TROLoadBank application
  hosts: '{{ HOSTS }}' 
  become: true
  gather_facts: false

  vars:
    image: jasmit/troloadbank
    tag: 25.1.0.2

  tasks:

    - name: Ensure Docker is installed
      ansible.builtin.package:
        name: docker.io
        state: present

    - name: Ensure Docker is running
      ansible.builtin.service:
        name: docker
        state: started
        enabled: true

    - name: Deploy a container using the image
      community.docker.docker_swarm_service:
        debug: true
        name: troloadbank
        image: "{{ image }}:{{ tag }}"
        mounts:
          - type: bind 
            source: /Volumes/synology_nfs
            target: /Volumes/nfs_volume
        command: '-e devl' 

    #  Sample use:
    #  make PLAYBOOK=troloadbank_deploy HOSTS=enki, run-on-hosts

...
